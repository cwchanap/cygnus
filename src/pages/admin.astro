---
import MainLayout from '@/layouts/main.astro';
import AdminUpload from '@/components/AdminUpload.svelte';
// Simple cookie parse to detect admin auth
const cookieHeader = Astro.request.headers.get('cookie') ?? '';
const authed = cookieHeader
  .split(';')
  .some((c) => c.trim().startsWith('admin_auth=1'));
const hasError = Astro.url.searchParams.get('error') != null;
--- 

<MainLayout content={{ title: 'Admin' }}>
  <main class="py-12">
    {authed ? (
      // Authenticated: show the admin upload UI
      <AdminUpload client:load passkeyOptional={true} />
    ) : (
      // Not authenticated: show unlock form
      <div class="max-w-md mx-auto p-8 bg-card text-card-foreground rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-6">Unlock Admin</h1>
        {hasError && (
          <p class="mb-4 text-sm text-destructive">Invalid passkey. Please try again.</p>
        )}
        <form method="post" action="/api/admin-login" class="space-y-4">
          <div>
            <label for="passkey" class="block text-sm font-medium text-muted-foreground">Passkey</label>
            <input type="password" id="passkey" name="passkey" required class="mt-1 block w-full px-3 py-2 bg-input border border-border rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-ring focus:border-ring sm:text-sm" />
          </div>
          <button type="submit" class="w-full appearance-none py-2 px-4 bg-primary text-primary-foreground font-semibold rounded-lg shadow-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-opacity-75">
            Unlock
          </button>
        </form>
      </div>
    )}
  </main>
</MainLayout>
